

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pythologist &mdash; pythologist 1.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> pythologist
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">pythologist</a><ul>
<li><a class="reference internal" href="#intro">Intro</a></li>
<li><a class="reference internal" href="#module-documentation">Module documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#quickstart">Quickstart</a></li>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#install-by-pip">Install by pip</a></li>
</ul>
</li>
<li><a class="reference internal" href="#common-tasks">Common tasks</a></li>
<li><a class="reference internal" href="#check-outputs-against-irisspatialfeatures-outputs">Check outputs against IrisSpatialFeatures outputs</a></li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pythologist</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>pythologist</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/README.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pythologist">
<h1>pythologist<a class="headerlink" href="#pythologist" title="Permalink to this headline">¶</a></h1>
<p><em>Read and analyze cell image data.</em></p>
<div class="section" id="intro">
<h2>Intro<a class="headerlink" href="#intro" title="Permalink to this headline">¶</a></h2>
<p>Pythologist 1) reads exports from InForm software or other sources into a common storage format, and 2) extracts basic analysis features from cell image data.  This software is generally intended to be run from a jupyter notebook and provides hooks into the image data so that the user can have the flexability to execute analyses they design or find in the primary literature.</p>
<p><a class="reference external" href="https://github.com/jason-weirather/pythologist/wiki/list-of-image-analysis-publications">List of image analysis publications</a></p>
<p>Pythologist is based on <a class="reference external" href="https://github.com/gusef/IrisSpatialFeatures">**IrisSpatialFeatures**</a> (C.D. Carey, ,D. Gusenleitner, M. Lipshitz, et al. Blood. 2017) <a class="reference external" href="https://doi.org/10.1182/blood-2017-03-770719">https://doi.org/10.1182/blood-2017-03-770719</a>, and is implemented in the python programming language.</p>
<p>Features Pythologist add are:</p>
<ul class="simple">
<li><p>An common CellProjectGeneric storage class, and classical inheritance conventions to organize the importation of different data types.</p></li>
<li><p>A mutable CellDataFrame class that can be used for slicing, and combining projects.</p></li>
<li><p>The ability to add binary features to cells based on cell-cell contacts or cell proximity.</p></li>
<li><p>Customizable images based on the cell segmentation or heatmaps spaninng the cartesian coordinates.</p></li>
<li><p>Specify cell populations through a SubsetLogic syntax for quick selection of mutually exclusive phenotypes or binary features</p></li>
<li><p>A set of Quality Check functions to identify potential issues in imported data.</p></li>
</ul>
</div>
<div class="section" id="module-documentation">
<h2>Module documentation<a class="headerlink" href="#module-documentation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pythologist</span></code> CellDataFrame class to modify and execute analysses [<a class="reference external" href="https://jason-weirather.github.io/pythologist/#modules">Read the Docs</a>] [<a class="reference external" href="https://github.com/jason-weirather/pythologist">source</a>]</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pythologist-reader</span></code> CellProject Storage Object [<a class="reference external" href="https://jason-weirather.github.io/pythologist-reader/">Read the Docs</a>] [<a class="reference external" href="https://github.com/jason-weirather/pythologist-reader">source</a>]</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pythologist-test-images</span></code> Example data [<a class="reference external" href="https://github.com/jason-weirather/pythologist-test-images">source</a>]</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pythologist-image-utilities</span></code> Helper functions to work with images [<a class="reference external" href="https://jason-weirather.github.io/pythologist-image-utilities/">Read the Docs</a>] [<a class="reference external" href="https://github.com/jason-weirather/pythologist-image-utilities">source</a>]</p></li>
</ul>
</div>
</div>
<div class="section" id="quickstart">
<h1>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline">¶</a></h1>
<p>To start a jupyter lab notebook with the required software as your user in your current drectory you can use the following command</p>
<p><code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">--rm</span> <span class="pre">-p</span> <span class="pre">8888:8888</span> <span class="pre">--user</span> <span class="pre">$(id</span> <span class="pre">-u):$(id</span> <span class="pre">-g)</span> <span class="pre">-v</span> <span class="pre">$(pwd):/work</span> <span class="pre">vacation/pythologist:latest</span></code></p>
<p>This will start jupyter lab on port 8888 as your user and group.</p>
<p>Any of the test data examples should work fine in this environment.</p>
</div>
<div class="section" id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="install-by-pip">
<h2>Install by pip<a class="headerlink" href="#install-by-pip" title="Permalink to this headline">¶</a></h2>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span>$ pip install pythologist
</pre></div>
</div>
</div>
</div>
<div class="section" id="common-tasks">
<h1>Common tasks<a class="headerlink" href="#common-tasks" title="Permalink to this headline">¶</a></h1>
<p>The assumption here is that the exports are grouped so that sample folders contain one or more image exports, and that sample name can be inferred from the last folder name.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pythologist_test_images</span> <span class="kn">import</span> <span class="n">TestImages</span>
<span class="kn">from</span> <span class="nn">pythologist_reader.formats.inform.sets</span> <span class="kn">import</span> <span class="n">CellProjectInForm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="c1"># Get the path of the test dataset</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">TestImages</span><span class="p">()</span><span class="o">.</span><span class="n">raw</span><span class="p">(</span><span class="s1">&#39;IrisSpatialFeatures&#39;</span><span class="p">)</span>
<span class="c1"># Create the storage opbject where the project will be saved</span>
<span class="n">cpi</span> <span class="o">=</span> <span class="n">CellProjectInForm</span><span class="p">(</span><span class="s1">&#39;pythologist.h5&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="c1"># Read the project data</span>
<span class="n">cpi</span><span class="o">.</span><span class="n">read_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">require</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">microns_per_pixel</span><span class="o">=</span><span class="mf">0.496</span><span class="p">,</span><span class="n">sample_name_index</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Display one of the cell map images</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">cpi</span><span class="o">.</span><span class="n">frame_iter</span><span class="p">():</span>
    <span class="k">break</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">frame_name</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cell_map_image</span><span class="p">(),</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<blockquote>
<div><p>MEL2_7</p>
<a class="reference external image-reference" href="https://github.com/jason-weirather/pythologist/blob/master/images/MEL2_7_cell_map.png?raw=true"><img alt="MEL2_7_cell_map" src="https://github.com/jason-weirather/pythologist/blob/master/images/MEL2_7_cell_map.png?raw=true" /></a>
</div></blockquote>
<p>Another format supported for a project import is one with a custom tumor and invasive margin definition.  Similar to above, the project is organized into sample folders, and each image within each sample folder has a <em>tif</em> file defining the tumor and invasive margin.  These come in the form of a <code class="docutils literal notranslate"><span class="pre">&lt;image</span> <span class="pre">name</span> <span class="pre">prefix&gt;_Tumor.tif</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;image</span> <span class="pre">name</span> <span class="pre">prefix&gt;_Invasive_Margin.tif</span></code> for each image.  The <code class="docutils literal notranslate"><span class="pre">_Tumor.tif</span></code> is an area filled in where the tumor is, and transparent elsewhere.  The <code class="docutils literal notranslate"><span class="pre">_Invasive_Margin.tif</span></code> is a drawn line of a known width.  <code class="docutils literal notranslate"><span class="pre">steps</span></code> is used to grow the margin out that many pixels in each direction to establish an invasive margin region.  Here we also rename some markers during read-in to clean up the syntax of thresholding on binary features.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pythologist_test_images</span> <span class="kn">import</span> <span class="n">TestImages</span>
<span class="kn">from</span> <span class="nn">pythologist_reader.formats.inform.custom</span> <span class="kn">import</span> <span class="n">CellProjectInFormLineArea</span>

<span class="c1"># Get the path of the test dataset</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">TestImages</span><span class="p">()</span><span class="o">.</span><span class="n">raw</span><span class="p">(</span><span class="s1">&#39;IrisSpatialFeatures&#39;</span><span class="p">)</span>
<span class="c1"># Specify where the data read-in will be stored as an h5 object</span>
<span class="n">cpi</span> <span class="o">=</span> <span class="n">CellProjectInFormLineArea</span><span class="p">(</span><span class="s1">&#39;test.h5&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="c1"># Read in the data (gets stored on the fly into the h5 object)</span>
<span class="n">cpi</span><span class="o">.</span><span class="n">read_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span>
              <span class="n">sample_name_index</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
              <span class="n">steps</span><span class="o">=</span><span class="mi">76</span><span class="p">,</span>
              <span class="n">project_name</span><span class="o">=</span><span class="s1">&#39;IrisSpatialFeatures&#39;</span><span class="p">,</span>
              <span class="n">microns_per_pixel</span><span class="o">=</span><span class="mf">0.496</span><span class="p">)</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">cpi</span><span class="o">.</span><span class="n">frame_iter</span><span class="p">():</span>
    <span class="k">break</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">frame_name</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;hand drawn margin&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;custom_images&#39;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;custom_label&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Drawn&#39;</span><span class="p">,</span><span class="s1">&#39;image_id&#39;</span><span class="p">]),</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;hand drawn tumor area&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;custom_images&#39;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;custom_label&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Area&#39;</span><span class="p">,</span><span class="s1">&#39;image_id&#39;</span><span class="p">]),</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Mutually exclusive Margin, Tumor, and Stroma&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;regions&#39;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;region_label&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Margin&#39;</span><span class="p">,</span><span class="s1">&#39;image_id&#39;</span><span class="p">]),</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;regions&#39;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;region_label&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Tumor&#39;</span><span class="p">,</span><span class="s1">&#39;image_id&#39;</span><span class="p">]),</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;regions&#39;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;region_label&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Stroma&#39;</span><span class="p">,</span><span class="s1">&#39;image_id&#39;</span><span class="p">]),</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<blockquote>
<div><p>MEL2_2</p>
<p>hand drawn margin</p>
<a class="reference external image-reference" href="https://github.com/jason-weirather/pythologist/blob/master/images/MEL2_2_drawn.png?raw=true"><img alt="MEL2_2_drawn_line" src="https://github.com/jason-weirather/pythologist/blob/master/images/MEL2_2_drawn.png?raw=true" /></a>
<p>hand drawn tumor area</p>
<a class="reference external image-reference" href="https://github.com/jason-weirather/pythologist/blob/master/images/MEL2_2_area.png?raw=true"><img alt="MEL2_2_drawn_line" src="https://github.com/jason-weirather/pythologist/blob/master/images/MEL2_2_area.png?raw=true" /></a>
<p>Mutually exclusive Margin, Tumor, and Stroma</p>
<a class="reference external image-reference" href="https://github.com/jason-weirather/pythologist/blob/master/images/MEL2_2_Margin.png?raw=true"><img alt="MEL2_2_margin" src="https://github.com/jason-weirather/pythologist/blob/master/images/MEL2_2_Margin.png?raw=true" /></a>
<a class="reference external image-reference" href="https://github.com/jason-weirather/pythologist/blob/master/images/MEL2_2_Tumor.png?raw=true"><img alt="MEL2_2_tumor" src="https://github.com/jason-weirather/pythologist/blob/master/images/MEL2_2_Tumor.png?raw=true" /></a>
<a class="reference external image-reference" href="https://github.com/jason-weirather/pythologist/blob/master/images/MEL2_2_Stroma.png?raw=true"><img alt="MEL2_2_stroma" src="https://github.com/jason-weirather/pythologist/blob/master/images/MEL2_2_Stroma.png?raw=true" /></a>
</div></blockquote>
<p>Here we will use the mask, but not expand or subtract from it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pythologist_test_images</span> <span class="kn">import</span> <span class="n">TestImages</span>
<span class="kn">from</span> <span class="nn">pythologist_reader.formats.inform.custom</span> <span class="kn">import</span> <span class="n">CellProjectInFormCustomMask</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">TestImages</span><span class="p">()</span><span class="o">.</span><span class="n">raw</span><span class="p">(</span><span class="s1">&#39;IrisSpatialFeatures&#39;</span><span class="p">)</span>
<span class="n">cpi</span> <span class="o">=</span> <span class="n">CellProjectInFormCustomMask</span><span class="p">(</span><span class="s1">&#39;test.h5&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">cpi</span><span class="o">.</span><span class="n">read_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span>
              <span class="n">microns_per_pixel</span><span class="o">=</span><span class="mf">0.496</span><span class="p">,</span>
              <span class="n">sample_name_index</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
              <span class="n">custom_mask_name</span><span class="o">=</span><span class="s1">&#39;Tumor&#39;</span><span class="p">,</span>
              <span class="n">other_mask_name</span><span class="o">=</span><span class="s1">&#39;Not-Tumor&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">cpi</span><span class="o">.</span><span class="n">frame_iter</span><span class="p">():</span>
    <span class="n">rs</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="s1">&#39;regions&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;region_label&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rs</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="s1">&#39;image_id&#39;</span><span class="p">]),</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">break</span>
</pre></div>
</div>
<blockquote>
<div><p>MEL2_2</p>
<p>Tumor</p>
<a class="reference external image-reference" href="https://github.com/jason-weirather/pythologist/blob/master/images/MEL2_2_tumor-b.png?raw=true"><img alt="MEL2_2_tumor" src="https://github.com/jason-weirather/pythologist/blob/master/images/MEL2_2_tumor-b.png?raw=true" /></a>
<p>Not-Tumor</p>
<a class="reference external image-reference" href="https://github.com/jason-weirather/pythologist/blob/master/images/MEL2_2_not-tumor-b.png?raw=true"><img alt="MEL2_2_not_tumor" src="https://github.com/jason-weirather/pythologist/blob/master/images/MEL2_2_not-tumor-b.png?raw=true" /></a>
</div></blockquote>
<p>Check general status of the CellDataFrame</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cdf</span> <span class="o">=</span> <span class="n">cpi</span><span class="o">.</span><span class="n">cdf</span>
<span class="n">cdf</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">cpi</span>
<span class="n">cdf</span><span class="o">.</span><span class="n">qc</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">print_results</span><span class="p">()</span>
</pre></div>
</div>
<p><em>prints the following QC metrics to stdout</em></p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span>==========
Check microns per pixel attribute
PASS
Microns per pixel is 0.496
==========
Check storage object is set
PASS
h5 object is set
==========
Is there a 1:1 correspondence between sample_name and sample_id?
PASS
Good concordance.
Issue count: 0/2
==========
Is there a 1:1 correspondence between frame_name and frame_id?
PASS
Good concordance.
Issue count: 0/4
==========
Is there a 1:1 correspondence between project_name and project_id?
PASS
Good concordance.
Issue count: 0/1
==========
Is the same frame name present in multiple samples?
PASS
frame_name&#39;s are all in their own samples
Issue count: 0/4
==========
Are the same phenotypes listed and following rules for mutual exclusion?
PASS
phenotype_calls and phenotype_label follows expected rules
==========
Are the same phenotypes included on all images?
PASS
Consistent phenotypes
Issue count: 0/4
==========
Are the same scored names included on all images?
PASS
Consistent scored_names
Issue count: 0/4
==========
Are the same regions represented the same with an image and across images?
PASS
Consistent regions
Issue count: 0/5
==========
Are the same regions listed matching a valid region_label
PASS
regions and region_label follows expected rules
==========
Do we have any region sizes so small they should consider being excluded?
WARNING
[
    &quot;Very small non-zero regions are included in the data[&#39;IrisSpatialFeatures&#39;, &#39;MEL2&#39;, &#39;MEL2_7&#39;, {&#39;Margin&#39;: 495640, &#39;Tumor&#39;: 947369, &#39;Stroma&#39;: 116}]&quot;
]
Issue count: 1/2
</pre></div>
</div>
<p>The cell phenotypes set prior to calling <code class="docutils literal notranslate"><span class="pre">cartesian</span></code> are the phenotypes available to plot.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pythologist_test_images</span> <span class="kn">import</span> <span class="n">TestImages</span>
<span class="kn">from</span> <span class="nn">plotnine</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">proj</span> <span class="o">=</span> <span class="n">TestImages</span><span class="p">()</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="s1">&#39;IrisSpatialFeatures&#39;</span><span class="p">)</span>
<span class="n">cdf</span> <span class="o">=</span> <span class="n">TestImages</span><span class="p">()</span><span class="o">.</span><span class="n">celldataframe</span><span class="p">(</span><span class="s1">&#39;IrisSpatialFeatures&#39;</span><span class="p">)</span>
<span class="n">cdf</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">proj</span>
<span class="n">cart</span> <span class="o">=</span> <span class="n">cdf</span><span class="o">.</span><span class="n">cartesian</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">step_pixels</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">max_distance_pixels</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">df</span><span class="p">,</span><span class="n">cols</span> <span class="o">=</span> <span class="n">cart</span><span class="o">.</span><span class="n">rgb_dataframe</span><span class="p">(</span><span class="n">red</span><span class="o">=</span><span class="s1">&#39;CD8+&#39;</span><span class="p">,</span><span class="n">green</span><span class="o">=</span><span class="s1">&#39;SOX10+&#39;</span><span class="p">)</span>
<span class="n">shape</span> <span class="o">=</span> <span class="n">cdf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;frame_shape&#39;</span><span class="p">]</span>
<span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;frame_x&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;frame_y&#39;</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s1">&#39;color_str&#39;</span><span class="p">))</span>
 <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#777777&#39;</span><span class="p">,</span><span class="n">stroke</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
 <span class="o">+</span> <span class="n">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;#555555&quot;</span><span class="p">)</span>
 <span class="o">+</span> <span class="n">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;#555555&quot;</span><span class="p">)</span>
 <span class="o">+</span> <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;#555555&quot;</span><span class="p">)</span>
 <span class="o">+</span> <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;#555555&quot;</span><span class="p">)</span>
 <span class="o">+</span> <span class="n">facet_wrap</span><span class="p">(</span><span class="s1">&#39;frame_name&#39;</span><span class="p">)</span>
 <span class="o">+</span> <span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span><span class="n">guide</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
 <span class="o">+</span> <span class="n">theme_bw</span><span class="p">()</span>
 <span class="o">+</span> <span class="n">theme</span><span class="p">(</span><span class="n">figure_size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
 <span class="o">+</span> <span class="n">theme</span><span class="p">(</span><span class="n">aspect_ratio</span><span class="o">=</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
 <span class="o">+</span> <span class="n">scale_y_reverse</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div><a class="reference external image-reference" href="https://github.com/jason-weirather/pythologist/blob/master/images/density_plots.png?raw=true"><img alt="Density Example" src="https://github.com/jason-weirather/pythologist/blob/master/images/density_plots.png?raw=true" /></a>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pythologist_test_images</span> <span class="kn">import</span> <span class="n">TestImages</span>
<span class="kn">from</span> <span class="nn">plotnine</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">proj</span> <span class="o">=</span> <span class="n">TestImages</span><span class="p">()</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="s1">&#39;IrisSpatialFeatures&#39;</span><span class="p">)</span>
<span class="n">cdf</span> <span class="o">=</span> <span class="n">TestImages</span><span class="p">()</span><span class="o">.</span><span class="n">celldataframe</span><span class="p">(</span><span class="s1">&#39;IrisSpatialFeatures&#39;</span><span class="p">)</span>
<span class="n">cdf</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">proj</span>
<span class="n">ch</span> <span class="o">=</span> <span class="n">cdf</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">qc</span><span class="p">()</span><span class="o">.</span><span class="n">channel_histograms</span><span class="p">()</span>
<span class="n">sub</span> <span class="o">=</span> <span class="n">ch</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="o">~</span><span class="n">ch</span><span class="p">[</span><span class="s1">&#39;threshold_value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())</span><span class="o">&amp;</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="s1">&#39;channel_label&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;PDL1&#39;</span><span class="p">)]</span>
<span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;bins&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;counts&#39;</span><span class="p">))</span>
 <span class="o">+</span> <span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s1">&#39;identity&#39;</span><span class="p">)</span>
 <span class="o">+</span> <span class="n">facet_wrap</span><span class="p">(</span><span class="s1">&#39;frame_name&#39;</span><span class="p">)</span>
 <span class="o">+</span> <span class="n">geom_vline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">xintercept</span><span class="o">=</span><span class="s1">&#39;threshold_value&#39;</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
 <span class="o">+</span> <span class="n">theme_bw</span><span class="p">()</span>
 <span class="o">+</span> <span class="n">ggtitle</span><span class="p">(</span><span class="s1">&#39;Thresholding of PDL1</span><span class="se">\n</span><span class="s1">given image pixel intensities&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p><em>The original component images were not available for IrisSpatialFeatures example, so pixel intensities are simulated and don’t necessarily match the those which would have been used to set the original threshold values.</em></p>
<blockquote>
<div><a class="reference external image-reference" href="https://github.com/jason-weirather/pythologist/blob/master/images/histogram_example.png?raw=true"><img alt="Histogram Example" src="https://github.com/jason-weirather/pythologist/blob/master/images/histogram_example.png?raw=true" /></a>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pythologist_test_images</span> <span class="kn">import</span> <span class="n">TestImages</span>
<span class="kn">from</span> <span class="nn">pythologist_reader.formats.inform.custom</span> <span class="kn">import</span> <span class="n">CellProjectInFormCustomMask</span>
<span class="kn">from</span> <span class="nn">pythologist</span> <span class="kn">import</span> <span class="n">SubsetLogic</span> <span class="k">as</span> <span class="n">SL</span>
<span class="n">cpi</span> <span class="o">=</span> <span class="n">TestImages</span><span class="p">()</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="s1">&#39;IrisSpatialFeatures&#39;</span><span class="p">)</span>
<span class="n">cdf</span> <span class="o">=</span> <span class="n">cpi</span><span class="o">.</span><span class="n">cdf</span>
<span class="n">cdf</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">cpi</span>
<span class="n">sub</span> <span class="o">=</span> <span class="n">cdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cdf</span><span class="p">[</span><span class="s1">&#39;frame_name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;MEL2_7&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">cont</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">contacts</span><span class="p">()</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="s1">&#39;CD8+&#39;</span><span class="p">,</span><span class="s1">&#39;CD8+/contact&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">contacts</span><span class="p">()</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="s1">&#39;SOX10+&#39;</span><span class="p">,</span><span class="s1">&#39;SOX10+/contact&#39;</span><span class="p">)</span>
<span class="n">cont</span> <span class="o">=</span> <span class="n">cont</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="s1">&#39;CD8+&#39;</span><span class="p">,</span><span class="s1">&#39;SOX10+/contact&#39;</span><span class="p">,</span>
                      <span class="n">positive_label</span><span class="o">=</span><span class="s1">&#39;CD8+ contact&#39;</span><span class="p">,</span>
                      <span class="n">negative_label</span><span class="o">=</span><span class="s1">&#39;CD8+&#39;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">threshold</span><span class="p">(</span><span class="s1">&#39;SOX10+&#39;</span><span class="p">,</span><span class="s1">&#39;CD8+/contact&#39;</span><span class="p">,</span>
              <span class="n">positive_label</span><span class="o">=</span><span class="s1">&#39;SOX10+ contact&#39;</span><span class="p">,</span>
              <span class="n">negative_label</span><span class="o">=</span><span class="s1">&#39;SOX10+&#39;</span><span class="p">)</span>
<span class="n">schema</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;subset_logic&#39;</span><span class="p">:</span><span class="n">SL</span><span class="p">(</span><span class="n">phenotypes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;OTHER&#39;</span><span class="p">]),</span>
     <span class="s1">&#39;edge_color&#39;</span><span class="p">:(</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>
     <span class="s1">&#39;watershed_steps&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
     <span class="s1">&#39;fill_color&#39;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;subset_logic&#39;</span><span class="p">:</span><span class="n">SL</span><span class="p">(</span><span class="n">phenotypes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SOX10+&#39;</span><span class="p">]),</span>
     <span class="s1">&#39;edge_color&#39;</span><span class="p">:(</span><span class="mi">166</span><span class="p">,</span><span class="mi">206</span><span class="p">,</span><span class="mi">227</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>
     <span class="s1">&#39;watershed_steps&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
     <span class="s1">&#39;fill_color&#39;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;subset_logic&#39;</span><span class="p">:</span><span class="n">SL</span><span class="p">(</span><span class="n">phenotypes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CD8+&#39;</span><span class="p">]),</span>
     <span class="s1">&#39;edge_color&#39;</span><span class="p">:(</span><span class="mi">253</span><span class="p">,</span><span class="mi">191</span><span class="p">,</span><span class="mi">111</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>
     <span class="s1">&#39;watershed_steps&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
     <span class="s1">&#39;fill_color&#39;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;subset_logic&#39;</span><span class="p">:</span><span class="n">SL</span><span class="p">(</span><span class="n">phenotypes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CD8+ contact&#39;</span><span class="p">]),</span>
     <span class="s1">&#39;edge_color&#39;</span><span class="p">:(</span><span class="mi">253</span><span class="p">,</span><span class="mi">191</span><span class="p">,</span><span class="mi">111</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>
     <span class="s1">&#39;watershed_steps&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
     <span class="s1">&#39;fill_color&#39;</span><span class="p">:(</span><span class="mi">255</span><span class="p">,</span><span class="mi">127</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;subset_logic&#39;</span><span class="p">:</span><span class="n">SL</span><span class="p">(</span><span class="n">phenotypes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SOX10+ contact&#39;</span><span class="p">]),</span>
     <span class="s1">&#39;edge_color&#39;</span><span class="p">:(</span><span class="mi">166</span><span class="p">,</span><span class="mi">206</span><span class="p">,</span><span class="mi">227</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>
     <span class="s1">&#39;watershed_steps&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
     <span class="s1">&#39;fill_color&#39;</span><span class="p">:(</span><span class="mi">31</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">255</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">]</span>
<span class="n">sio</span> <span class="o">=</span> <span class="n">cont</span><span class="o">.</span><span class="n">segmentation_images</span><span class="p">()</span><span class="o">.</span><span class="n">build_segmentation_image</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span><span class="n">background</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">))</span>
<span class="n">sio</span><span class="o">.</span><span class="n">write_to_path</span><span class="p">(</span><span class="s1">&#39;test_edges&#39;</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div><p>MEL2_7</p>
<a class="reference external image-reference" href="https://github.com/jason-weirather/pythologist/blob/master/images/MEL2_7-contacts.png?raw=true"><img alt="Visualize Contacts" src="https://github.com/jason-weirather/pythologist/blob/master/images/MEL2_7-contacts.png?raw=true" /></a>
</div></blockquote>
<p><em>Image is zoomed-in and cropped to show the contours better.</em></p>
<p>This happens frequently because current InForm exports only permit two features to be scored per export</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="p">,</span><span class="n">fail</span> <span class="o">=</span> <span class="n">cdf1</span><span class="o">.</span><span class="n">merge_scores</span><span class="p">(</span><span class="n">cdf2</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sample_name&#39;</span><span class="p">,</span><span class="s1">&#39;frame_name&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cdf</span><span class="o">.</span><span class="n">scored_names</span>
</pre></div>
</div>
<blockquote>
<div><p>[‘PD1’, ‘PDL1’]</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cdf</span><span class="o">.</span><span class="n">phenotypes</span>
</pre></div>
</div>
<blockquote>
<div><p>[‘CD8+’, ‘OTHER’, ‘SOX10+’]</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cdf</span><span class="o">.</span><span class="n">regions</span>
</pre></div>
</div>
<blockquote>
<div><p>[‘Margin’, ‘Stroma’, ‘Tumor’]</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">collapsed</span> <span class="o">=</span> <span class="n">cdf</span><span class="o">.</span><span class="n">collapse_phenotypes</span><span class="p">([</span><span class="s1">&#39;CD8+&#39;</span><span class="p">,</span><span class="s1">&#39;OTHER&#39;</span><span class="p">],</span><span class="s1">&#39;non-Tumor&#39;</span><span class="p">)</span>
<span class="n">collapsed</span><span class="o">.</span><span class="n">phenotypes</span>
</pre></div>
</div>
<blockquote>
<div><p>[‘SOX10+’, ‘non-Tumor’]</p>
</div></blockquote>
<p>Rename <em>TUMOR</em> to <em>Tumor</em></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">renamed</span> <span class="o">=</span> <span class="n">cdf</span><span class="o">.</span><span class="n">rename_region</span><span class="p">(</span><span class="s1">&#39;TUMOR&#39;</span><span class="p">,</span><span class="s1">&#39;Tumor&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">renamed</span> <span class="o">=</span> <span class="n">cdf</span><span class="o">.</span><span class="n">rename_scored_calls</span><span class="p">({</span><span class="s1">&#39;PDL1 (Opal 520)&#39;</span><span class="p">:</span><span class="s1">&#39;PDL1&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>Make <em>CYTOK</em> into <em>CYTOK PDL1+</em> and <em>CYTOK PDL1-</em></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">raw_thresh</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="s1">&#39;CYTOK&#39;</span><span class="p">,</span><span class="s1">&#39;PDL1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">CD68_CD163</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="s1">&#39;CD68&#39;</span><span class="p">,</span><span class="s1">&#39;CD163&#39;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">threshold</span><span class="p">(</span><span class="s1">&#39;CD68 CD163+&#39;</span><span class="p">,</span><span class="s1">&#39;PDL1&#39;</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">threshold</span><span class="p">(</span><span class="s1">&#39;CD68 CD163-&#39;</span><span class="p">,</span><span class="s1">&#39;PDL1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>generate counts and fractions of the current phenotypes and export them to a csv</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cdf</span><span class="o">.</span><span class="n">counts</span><span class="p">()</span><span class="o">.</span><span class="n">frame_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;my_frame_counts.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>generate counts and fractions of the current phenotypes and export them to a csv</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cdf</span><span class="o">.</span><span class="n">counts</span><span class="p">()</span><span class="o">.</span><span class="n">sample_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;my_sample_counts.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The follow command creates a new CellDataFrame that has an additional binary feature representative of the contact with ‘T cell’ phenotype cells.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cdf</span> <span class="o">=</span> <span class="n">cdf</span><span class="o">.</span><span class="n">contacts</span><span class="p">()</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="s1">&#39;T cell&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The follow command creates a new CellDataFrame that has an additional binary feature representative of being inside or outisde 75 microns of ‘T cell’ phenotype cells.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cdf</span> <span class="o">=</span> <span class="n">cdf</span><span class="o">.</span><span class="n">nearestneighbors</span><span class="p">()</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="s1">&#39;T cell&#39;</span><span class="p">,</span><span class="s1">&#39;T cell/within 75um&#39;</span><span class="p">,</span><span class="n">distance_um</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<div class="section" id="check-outputs-against-irisspatialfeatures-outputs">
<h1>Check outputs against IrisSpatialFeatures outputs<a class="headerlink" href="#check-outputs-against-irisspatialfeatures-outputs" title="Permalink to this headline">¶</a></h1>
<p>To ensure we are generating expected outs we can check against the outputs of IrisSpatialFeatures [<a class="reference external" href="https://github.com/gusef/IrisSpatialFeatures">github</a>].</p>
<ul class="simple">
<li><p>Jupyter Notebook: <a class="reference external" href="https://github.com/jason-weirather/pythologist/blob/master/notebooks/Test%20against%20IrisSpatialFeatures%20outputs.ipynb">Test against IrisSpatialFeatures outputs</a></p></li>
</ul>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Jason L Weirather

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>